<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>子網路快速計算機 - 深色簡潔版</title>
    <style>
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background-color: #121212; 
            color: #e0e0e0; 
            display: flex; 
            justify-content: center; 
            padding: 20px; margin: 0;
        }
        .card { 
            background: #1e1e1e; 
            padding: 25px; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            width: 100%; 
            max-width: 500px; 
            border: 1px solid #333;
        }
        h2 { color: #64b5f6; text-align: center; font-weight: 300; margin-bottom: 25px; }
        
        .input-box {
            display: flex;
            background: #2c2c2c;
            border: 2px solid #444;
            border-radius: 12px;
            padding: 5px 15px;
            align-items: center;
            transition: 0.3s;
            margin-bottom: 25px;
        }
        .input-box:focus-within { border-color: #64b5f6; }
        input {
            background: transparent;
            color: #fff;
            border: none;
            padding: 12px;
            font-size: 1.2rem;
            outline: none;
            width: 100%;
        }
        #cidrInput { width: 65px; text-align: center; border-left: 1px solid #444; margin-left: 10px; }
        .slash { font-size: 1.5rem; color: #64b5f6; font-weight: bold; }

        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .result-item { background: #252525; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .label { font-size: 0.75rem; color: #888; text-transform: uppercase; margin-bottom: 6px; }
        .value { font-size: 1.1rem; font-weight: bold; color: #64b5f6; font-family: 'Courier New', monospace; }
        .important { color: #ff5252; } 

        .full-width { grid-column: span 2; }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>

<div class="card">
    <h2>子網路切割計算</h2>
    
    <div class="input-box">
        <input type="text" id="ipInput" placeholder="192.168.1.1" oninput="calculate()" onfocus="this.select()" autofocus>
        <span class="slash">/</span>
        <input type="number" id="cidrInput" placeholder="32" min="0" max="32" oninput="calculate()" onfocus="this.select()">
    </div>

    <div class="result-grid">
        <div class="result-item">
            <div class="label">網路 ID (Network ID)</div>
            <div id="resNetwork" class="value">--</div>
        </div>
        <div class="result-item">
            <div class="label">子網路遮罩 (Mask)</div>
            <div id="resMask" class="value">--</div>
        </div>
        <div class="result-item full-width">
            <div class="label">可用 IP 範圍</div>
            <div id="resRange" class="value">--</div>
        </div>
        <div class="result-item">
            <div class="label">廣播位址 (Broadcast)</div>
            <div id="resBroadcast" class="value important">--</div>
        </div>
        <div class="result-item">
            <div class="label">可用主機數</div>
            <div id="resHosts" class="value">--</div>
        </div>
    </div>
</div>

<script>
function ipToLong(ip) {
    var d = ip.split('.');
    return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
}

function longToIp(l) {
    return [ (l >>> 24) & 0xFF, (l >>> 16) & 0xFF, (l >>> 8) & 0xFF, l & 0xFF ].join('.');
}

function calculate() {
    const ipStr = document.getElementById('ipInput').value;
    const cidrStr = document.getElementById('cidrInput').value;

    if (!ipStr.match(/^(\d{1,3}\.){3}\d{1,3}$/) || cidrStr === "") {
        resetUI();
        return;
    }

    const cidr = parseInt(cidrStr);
    if (cidr < 0 || cidr > 32) return;

    const ipLong = ipToLong(ipStr);
    const maskLong = cidr === 0 ? 0 : (0xFFFFFFFF << (32 - cidr)) >>> 0;
    const netLong = (ipLong & maskLong) >>> 0;
    const broadcastLong = (netLong | (~maskLong)) >>> 0;

    let firstHost = netLong + 1;
    let lastHost = broadcastLong - 1;
    let totalHosts = Math.max(0, broadcastLong - netLong - 1);

    // 特殊 CIDR 處理
    if (cidr === 32) {
        firstHost = lastHost = netLong;
        totalHosts = 1;
    } else if (cidr === 31) {
        firstHost = netLong;
        lastHost = broadcastLong;
        totalHosts = 2;
    }

    document.getElementById('resNetwork').innerText = longToIp(netLong);
    document.getElementById('resMask').innerText = longToIp(maskLong);
    document.getElementById('resRange').innerText = longToIp(firstHost) + " ~ " + longToIp(lastHost);
    document.getElementById('resBroadcast').innerText = longToIp(broadcastLong);
    document.getElementById('resHosts').innerText = totalHosts.toLocaleString();
}

function resetUI() {
    ['resNetwork', 'resMask', 'resRange', 'resBroadcast', 'resHosts'].forEach(id => {
        document.getElementById(id).innerText = "--";
    });
}
</script>

</body>
</html>
