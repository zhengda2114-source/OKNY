<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Subnet Calc Mobile</title>
    <style>
        :root {
            --bg-color: #0f1012;
            --card-bg: #1c1e22;
            --accent-blue: #00a2ff;
            --accent-red: #ff5e5e;
            --text-main: #e0e6ed;
            --text-dim: #8892b0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 400px; /* 針對手機寬度 */
        }
        h2 {
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            margin: 20px 0 30px;
            letter-spacing: 1px;
            color: var(--accent-blue);
        }
        
        /* 輸入區域 */
        .input-section {
            display: flex;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 25px;
            border: 1px solid #333;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        input {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 22px;
            font-family: 'Courier New', monospace;
            outline: none;
        }
        #ipInput { flex: 1; padding-left: 10px; }
        .slash { font-size: 24px; color: var(--accent-blue); font-weight: bold; margin: 0 10px; }
        #cidrInput { width: 60px; text-align: center; border-left: 1px solid #444; }

        /* 結果清單佈局 */
        .result-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .result-card {
            background: var(--card-bg);
            padding: 18px;
            border-radius: 15px;
            border-left: 4px solid var(--accent-blue);
        }
        .result-card.important { border-left-color: var(--accent-red); }
        
        .label {
            font-size: 13px;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        .value {
            font-size: 20px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        .blue-val { color: var(--accent-blue); }
        .red-val { color: var(--accent-red); }

        /* 移除手機輸入數字的箭頭 */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>子網路切割計算</h2>
    
    <div class="input-section">
        <input type="text" id="ipInput" placeholder="192.168.1.1" inputmode="decimal" oninput="calculate()" onfocus="this.select()" autofocus>
        <span class="slash">/</span>
        <input type="number" id="cidrInput" placeholder="32" min="0" max="32" oninput="calculate()" onfocus="this.select()">
    </div>

    <div class="result-list">
        <div class="result-card">
            <div class="label">網路 ID (Network ID)</div>
            <div id="resNetwork" class="value blue-val">--</div>
        </div>
        
        <div class="result-card">
            <div class="label">子網路遮罩 (Mask)</div>
            <div id="resMask" class="value">--</div>
        </div>
        
        <div class="result-card">
            <div class="label">可用 IP 範圍</div>
            <div id="resRange" class="value blue-val" style="font-size: 18px;">--</div>
        </div>
        
        <div class="result-card important">
            <div class="label">廣播位址 (Broadcast)</div>
            <div id="resBroadcast" class="value red-val">--</div>
        </div>
        
        <div class="result-card">
            <div class="label">可用主機數 (Hosts)</div>
            <div id="resHosts" class="value">--</div>
        </div>
    </div>
</div>

<script>
function ipToLong(ip) {
    var d = ip.split('.');
    return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
}

function longToIp(l) {
    return [ (l >>> 24) & 0xFF, (l >>> 16) & 0xFF, (l >>> 8) & 0xFF, l & 0xFF ].join('.');
}

function calculate() {
    const ipStr = document.getElementById('ipInput').value;
    const cidrStr = document.getElementById('cidrInput').value;

    if (!ipStr.match(/^(\d{1,3}\.){3}\d{1,3}$/) || cidrStr === "") {
        resetUI();
        return;
    }

    const cidr = parseInt(cidrStr);
    if (cidr < 0 || cidr > 32) return;

    const ipLong = ipToLong(ipStr);
    const maskLong = cidr === 0 ? 0 : (0xFFFFFFFF << (32 - cidr)) >>> 0;
    const netLong = (ipLong & maskLong) >>> 0;
    const broadcastLong = (netLong | (~maskLong)) >>> 0;

    let firstHost = netLong + 1;
    let lastHost = broadcastLong - 1;
    let totalHosts = Math.max(0, broadcastLong - netLong - 1);

    if (cidr === 32) { firstHost = lastHost = netLong; totalHosts = 1; }
    else if (cidr === 31) { firstHost = netLong; lastHost = broadcastLong; totalHosts = 2; }

    document.getElementById('resNetwork').innerText = longToIp(netLong);
    document.getElementById('resMask').innerText = longToIp(maskLong);
    document.getElementById('resRange').innerText = longToIp(firstHost) + "\n~ " + longToIp(lastHost);
    document.getElementById('resBroadcast').innerText = longToIp(broadcastLong);
    document.getElementById('resHosts').innerText = totalHosts.toLocaleString();
}

function resetUI() {
    ['resNetwork', 'resMask', 'resRange', 'resBroadcast', 'resHosts'].forEach(id => {
        document.getElementById(id).innerText = "--";
    });
}
</script>

</body>
</html>
